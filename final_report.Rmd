---
title: "P8105 - Final Project Report"
output: 
  html_document:
    toc: true
    toc_float: true
---

```{r setup, include=FALSE}
library(haven)
library(tidyverse)
library(plotly)

knitr::opts_chunk$set(
  fig.width = 6,
  fig.asp = .6,
  out.width = "90%")

theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis")
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

```{r, echo=FALSE}
nhats = read_sas("./final_data/nhats_r5.sas7bdat")  %>%
  select(spid, hc5depresan1, hc5depresan2, r5dgender, r5d2intvrage, rl5dracehisp, md5canewlker, 
         sn5dnumsn, cg5ratememry, hc5health, wb5truestme4) %>%
  janitor::clean_names() %>%   
  filter(hc5depresan1 > 0, hc5depresan2 > 0, sn5dnumsn >= 0, r5d2intvrage > 0, md5canewlker > 0, 
         cg5ratememry > 0, hc5health > 0, wb5truestme4 > 0, rl5dracehisp < 5)

nhats %>% 
  select(hc5depresan1, hc5depresan2)  %>% 
  rowSums(na.rm = TRUE) -> nhats$phq.total

nhats = nhats %>%
  mutate(phq.total = phq.total - 2) %>% 
  mutate(phq_cat = if_else(phq.total < 3, "Mild/No Depression", "Moderate/Severe Depression")) %>% 
  mutate(
    gender = recode(r5dgender, `1` = "Male", `2` = "Female"),
    gender = factor(gender),
    age_cat = recode(r5d2intvrage, `1` = "65 to 69", `2` = "70 to 74", `3` = "75 to 79", 
                 `4` = "80 to 84", `5` = "85 to 89", `6` = "90+"),
    age_cat = factor(age_cat, levels = c("65 to 69", "70 to 74", "75 to 79", "80 to 84", 
                  "85 to 89", "90+")),
    race_ethnicity = recode(rl5dracehisp, `1` = "White, non-hispanic", `2` = "Black, non-hispanic", 
                  `3` = "Other, non-hispanic", `4` = "Hispanic"),
    race_ethnicity = factor(race_ethnicity),
    cane_walker_wheelchair = recode(md5canewlker, `1` = "Yes", `2` = "No"),
    cane_walker_wheelchair = factor(cane_walker_wheelchair),
    memory = recode(cg5ratememry, `1` = "Excellent", `2` = "Very Good", `3` = "Good", 
                    `4` = "Fair", `5` = "Poor"),
    memory = factor(memory, c("Excellent", "Very Good", "Good", "Fair", "Poor")),
    overall_health = recode(hc5health, `1` = "Excellent", `2` = "Very Good", `3` = "Good", 
                    `4` = "Fair", `5` = "Poor"),
    overall_health = factor(overall_health, levels = c("Excellent", "Very Good", "Good", "Fair", 
                    "Poor")),
    likes_living_situation = recode(wb5truestme4, `1` = "Agree a lot", `2` = "Agree a little", 
                    `3` = "Agree not at all"),
    likes_living_situation = factor(likes_living_situation, c("Agree a lot", "Agree a little", 
                    "Agree not at all")),
    ) %>% 
    rename(social_network_size = sn5dnumsn)
```

### Assessing predictors of depression risk in older adults

##### Group Members:
Ifrah Fayyaz (if2282), Lydia Parr (lcp2148), Lauren Cohen (lcc2181), Onyeka Isamah (oi2142), Riddhi Thakkar (rt2640) 



#### Study motivation and goals
The motivation for this project is to identify predictors of depression outcomes among older adults. In this project, predictors of interest are gender, age, race/ethnic group, whether respondent uses an assistive device (cane, a walker, or a wheelchair), self-rated memory, overall health condition, whether the respondent likes their living situation, and the respondents social network size. Older adults were chosen as the target population since we know that they are a population that is known to have higher risk of depression compared to the general population. Publications that have studied the associations of these specific predictor variables and depression outcomes were also the inspiration of this project. 

#### Initial questions
Initially, we wanted to see what variables had an effect on quality of life within our population in the dataset. We needed to get more specific about our analyses plan, so we had to ask questions as to the best variables to include and the best methods to manipulate and define them. For example, we asked ourselves how we would measure the depression outcome, which led to use creating a variable that would serve has the PHQ-2 measure. Our initial question also evolved as we specified exactly which predictors we wanted to explore in the analyses, as we had numerous predictors available in the data set. We also spent time considering which levels should be excluded and how to correctly order factor variables. 

#### Data 
**Source**: National Health and Aging Trends Study
from Johns Hopkins and Westat

**Methods and data cleaning**: 
Using only round 5 data, included ID variable, the two variables needed for the depression risk scale (PHQ-2), gender, age, race, whether participant uses mobility devices, size of social network, whether or not they have no one to talk to, self reported memory issues causing problems, self-rated health, and whether they are happy with their living situation. 

In creating dichotomous variable phq_cat regarding depression status, phq.total was subtracted by 2 to account for the fact that total scores on the PHQ-2 should range from 0-6 (sum of two items ranging from 0-3, while scores for the two items provided in our data ranged from 1-4). Once 2 was subtracted from the total score, phq_cat was dichotomized based on a cutoff point of 3 or higher.

Categorical variables were re-coded to include descriptions of values and converted into factors.

The following variables will be included in analyses:


* `gender`: Gender (Male, Female)
* `age_cat`: Categorical age at interview (65 to 69, 70 to 74, 75 to 79, 80-84, 85-89, 90+)
* `race_ethnicity`: Race and Hispanic ethnicity (White, non-Hispanic; Black, non-Hispanic; Other, non-Hispanic; Hispanic)
* `cane_walker_wheelchair`: Used cane, walker, wheelchair (Yes, No)
* `memory`: Rate your memory (Excellent, Very Good, Good, Fair, Poor)
* `overall_health`: Overall health condition (Excellent, Very Good, Good, Fair, Poor)
* `likes_living_situation`: Likes living situation (Agree a lot, Agree a little, Agree not at all)
* `social_network_size`: Social network size (0, 1, 2, 3, 4, 5)

* The outcome variable of interest is:
*`PHQ-cat`: Depression (dichotomized based on total PHQ-2 score)

#### Exploratory analysis: add link to dashboard.  

Visualizations, summaries, and exploratory statistical analyses. Justify the steps you took, and show any major changes to your ideas.

- Figure 1: Demographic frequencies:

- Figure 2: Plotting of participant view of living situation predictor against PHQ-2, stratified by race (EM)

- Figure 3: Plotting social network  by phq_cat:

- Figure 4: Plotting health condition by phq_cat

- Figure 5: Self rated memory and depression categories 

- Figure 6: Use of assistive devices (cane, walker, wheelchair) and depression outcomes (PHQ-2)


####  Additional analyses: multivariable logistic regression

 **Results**: are we adjusting for?
 
 
Predictors age category (70-74), age_cat (85-89), age_cat (90+), race_ethnicity (White, non-Hispanic), cane_walker_wheelchair (Yes), memory (Fair), memory (Poor), overall_health (Good), overall_health (Fair), overall_health (Poor), likes_living_situation (Agree a little,) likes_living_situation (Agree not at all), all had significant p-values that were less than alpha .05.

 *OR Interpretations, Age*: Respondents among those who were in age category 85 to 89 had 26.7% decreased odds of scoring a 3 or more on the PHQ-2 compared to respondents who were age categories 65 to 69. 
 
 *OR Interpretations, Race*: Non Hispanic White respondents had 24.7% decreased odds of scoring a 3 or more on the PHQ-2 compared to Black respondents.
 
 *OR Interpretations, Overall health condition*Those who responded as "Fair" when asked about their overall health condition had 1.5 times the increased odds of scoring a 3 or more on the PHQ-2 compared to those who responded as "Excellent". 
 
 
 
```{r, echo=FALSE}
logit_model = nhats %>%
  mutate(phq_cat = if_else(phq_cat == "Mild/No Depression", 0, 1)) %>%
  glm(phq_cat ~ gender + age_cat + race_ethnicity + cane_walker_wheelchair + memory + overall_health + likes_living_situation + social_network_size, family = "binomial", data = .) 

logit_model %>%
  broom::tidy() %>%
  mutate(OR = exp(estimate)) %>%
  select(term, betas = estimate, OR, p.value) %>%
  knitr::kable(digits = 3)
```

##### **Discussion**: What were your findings? Are they what you expect? What insights into the data can you make?